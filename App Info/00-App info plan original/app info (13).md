## **1\) الدفع عند الاستلام (COD)**

**القاعدة**: اختلاف سياسة الدفع حسب المحافظة.  
**الفائدة**: تقليل إلغاء الطلبات وتحقيق ثقة أكبر.  
**التطبيق**:

* أوضاع الدفع:  
  * `cod_standard`: الدفع كاملًا عند الاستلام (صنعاء).  
  * `cod_deposit_required`: دفع عربون \+ الباقي عند الاستلام (بقية المحافظات). لم يحدد بعد  
  * `prepaid_optional`: خيار الدفع المسبق عند الرغبة.  
* واجهة المستخدم تعرض رسالة/Modal توضح سياسة الدفع حسب المنطقة.  
* Analytics event: `add_payment_info.payment_type` مع قيمة (cod\_standard / cod\_deposit / prepaid).

  ---

  ## **2\) سياسة الصور والأداء (Image/CDN Policy)**

**القاعدة**: الصور يتم تحميلها عبر CDN مع تحجيم وضغط ديناميكي.  
**الفائدة**: سرعة تحميل أعلى \+ تقليل استهلاك البيانات \+ حجم تطبيق أصغر.  
**التطبيق**:

* PLP: `w=360, q=75` (≤ 250KB).  
* PDP: `w=1080, q=80` (≤ 800KB).  
* استخدام WebP/AVIF مع fallback.  
* placeholder/skeleton عند التحميل.  
* التحقق من حجم التطبيق ≤ 40MB عبر CI.

  ---

  ## **3\) التحليلات (Analytics & Events)**

**القاعدة**: أحداث موحدة \+ أبعاد ثابتة.  
**الفائدة**: قياس funnel بدقة، ودعم قرارات الأعمال.  
**التطبيق**:

* الأحداث الأساسية: `view_item`, `add_to_cart`, `begin_checkout`, `add_shipping_info`, `add_payment_info`, `purchase`.  
* الأبعاد الثابتة:  
  * `user_id` (مشفّر/مجهول).  
  * `app_version`.  
  * `region` (المحافظة).  
  * `currency = YER`.  
  * `channel` (organic / ads / meta).  
* مطابقة البيانات مع السيرفر ≥ 95%.

  ---

  ## **4\) الإشعارات (Push Notifications)**

**القاعدة**: فصل الإشعارات الترويجية عن التشغيلية.  
**الفائدة**: تجربة مستخدم أوضح \+ تقليل الإزعاج.  
**التطبيق**:

* التصنيفات:  
  * `promo`: عروض وتخفيضات.  
  * `transactional`: تأكيد الطلب، تحديث حالة الشحن.  
* هيكل الرسالة: `{title, body, deeplink, campaign_id, expire_at}`.  
* دعم deeplink لشاشات المنتج/الطلب/العرض.  
* قاعدة منع الإزعاج: لا رسائل promo خلال 48 ساعة بعد الشراء.

  ---

  ## **5\) سيناريوهات الأخطاء التجارية (Commerce Errors)**

**القاعدة**: رسائل واضحة \+ حلول بديلة.  
**الفائدة**: تقليل فقدان العملاء عند الفشل.  
**التطبيق**:

* `coupon_invalid`: الكوبون غير صالح.  
* `coupon_expired`: انتهت صلاحية الكوبون.  
* `stock_conflict (409)`: نفاد المخزون، اقتراح مقاس/لون بديل.  
* `address_unsupported`: التوصيل غير متاح للمدينة.  
* `deposit_required`: المنطقة تتطلب عربون.  
* UI يعرض زر بديل (تعديل العنوان/الكوبون/المقاس).

  ---

  ## **6\) إدارة الجلسات (Session & Token Refresh)**

**القاعدة**: الحفاظ على أمان الجلسات واستمراريتها.  
**الفائدة**: منع طرد المستخدم بشكل مفاجئ \+ أمان أعلى.  
**التطبيق**:

* Token refresh عند انتهاء الصلاحية.  
* في حال فشل التحديث → تسجيل خروج نظيف مع إشعار.  
* منع تخزين tokens في SharedPreferences، والاكتفاء بـ Secure Storage.

  ---

  ## **7\) اختبارات الأداء والميزانيات (Performance Budgets)**

**القاعدة**: تحديد حدود صارمة للأداء والحجم.  
**الفائدة**: تجربة أفضل على الأجهزة الضعيفة \+ سرعة تشغيل.  
**التطبيق**:

* cold start ≤ 2 ثانية (Android متوسط).  
* بناء PDP ≤ 120ms.  
* scroll jank \< 0.5%.  
* حجم التطبيق ≤ 40MB.  
* CI يفشل إذا زاد حجم البيلد \> 5% عن الإصدار السابق.



---

## 🏠 **Back to Home | العودة للرئيسية**

[← Back to Main Index | العودة للفهرس الرئيسي](../../../index.html)

---
