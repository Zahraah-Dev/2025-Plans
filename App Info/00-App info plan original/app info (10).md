**5\) ุงูุฃูุงู ุฏุงุฎู ุงูุชุทุจูู (Security Layer)**

## **ุงููุงุฆุฏุฉ**

* ุญูุงูุฉ ุจูุงูุงุช ุงูุนููู (ุงูุญุณุงุจุ ุงูุนูุงูููุ ุงูุทูุจุงุช).  
* ููุน ุฅุณุงุกุฉ ุงุณุชุฎุฏุงู ุงููุงุฌูุงุช (API) ูุชูููู ุงูููุงุชูุฑ ุงููุงุชุฌุฉ ุนู ุงููุฌูุงุช.  
* ุงูุงูุชุฒุงู ุจุงูููุงุฑุณุงุช ุงูุฌูุฏุฉ ููุฎุตูุตูุฉ ูุงูุซูุฉ ุจุงูุนูุงูุฉ.

---

## **ุงููุทููุจ ูู ุงูุชูููุฐ**

### **A) ุฌูุณุงุช ุงููุณุชุฎุฏู ูุงูุฑููุฒ (Tokens)**

* ุงุณุชุฎุฏุงู **Firebase ID Token** ุญุตุฑููุง ูู ุชุฑููุณุฉ `Authorization: Bearer <token>`.  
* **ุชุญุฏูุซ ุชููุงุฆู** ููุฑูุฒ ูุจู ุงูุชูุงุก ุตูุงุญูุชูุ ุนูุฏ ุงููุดู โ ุงูุงูุชูุงู ูุตูุญุฉ ุงูุฏุฎูู.  
* ุญูุธ ุงูุฑูุฒ ููุนูููุงุช ุงูุฌูุณุฉ ูู **ุชุฎุฒูู ุขูู** (Keychain/iOS, Keystore/Android) ูููุณ ูู SharedPrefs ุงูุนุงุฏูุฉ.  
* ุนูุฏ **ุชุณุฌูู ุงูุฎุฑูุฌ**: ูุณุญ ูู ุงูุฑููุฒ ูุงููุงุด ุงูุญุณุงุณ (ุณูุฉ/ุนูุงููู).

### **App Check (B  (ุฅุซุจุงุช ุฃุตู ุงูุชุทุจูู)**

* ุฅุฑุณุงู ุชุฑููุณุฉ `X-App-Check` ูุน ูู ุทูุจุงุช ุงูุดุจูุฉ (ุฅู ููุนูู ูู ุงููBackend).  
* ูุนุงูุฌุฉ ุฃุฎุทุงุก App Check ุจุฑุณุงุฆู ูุฏููุฉ (ุงุทูุจู ุงูุชุญุฏูุซ/ุฃุนูุฏู ุงููุญุงููุฉ).

### **C) ุงูุงุชุตุงูุงุช ุงูุดุจููุฉ**

* ุฅูุฒุงู **HTTPS ููุท**ุ ุชุนุทูู ุฃู ูุจูู ูุดูุงุฏุงุช ุบูุฑ ููุซููุฉ.  
* **(ุงุฎุชูุงุฑู ููุถูู)**: ุชูุนูู **SSL Pinning** ูุฒูุงุฏุฉ ุงูุญูุงูุฉ ูู MITM.  
* ุถุจุท ูููุงุช ููุนุงูุฏุฉ ูุญุงููุงุช ุฐููุฉ (Exponential Backoff) ูุน ุณูู ูุญุงููุงุช.

### **D) ุงูุฑูุงุจุท ุงูุนูููุฉ ูุงูุชูููู (Deep Links)**

* ุงูุณูุงุญ ุจุฑูุงุจุท ูู **ูุงุฆูุฉ ูุทุงูุงุช ููุซููุฉ ููุท**.  
* ุงูุชุญูู ูู **ุงููุนููุงุช** ูุจู ุงุณุชุฎุฏุงููุง (ูุง ุชุนุชูุฏ ููู URL ูุจุงุดุฑุฉ ูู ููุทู ุญุณุงุณ).  
* ุฃู ุฑุงุจุท ูุงูุต/ูุฑูุจ โ ุดุงุดุฉ ุขููุฉ ุจุฑุณุงูุฉ ุฎุทุฃ ุนุงูุฉ.

### **E) ุงูุจูุงูุงุช ุงููุญููุฉ (Local Data)**

* ุชุดููุฑ ูุง ูููู ุชุดููุฑู (ุงูุนูุงูููุ ุงูุณูุฉ ุฅู ูุงูุช ุชุชุถูู ุฃุณุนุงุฑ ุชูุตูููุฉ).  
* ุชูุธูู ุงููุงุด ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ ุฃู ุนูุฏ ุชุจุฏูู ุงูุญุณุงุจ.  
* ููุน ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุณุญุงุจู ููุจูุงูุงุช ุงูุญุณุงุณุฉ (Android: `allowBackup=false`ุ iOS: ุงุณุชุซูุงุก ุงููููุงุช ุงูุญุณุงุณุฉ ูู iCloud backup).

### **F) ุงูุฎุตูุตูุฉ ูุงููPII**

* **ูุง** ูุฎุฒู ุฃู ูุฑุณู ุฃุจุฏูุง: ุฑูู OTPุ ูููุงุช ูุฑูุฑุ ููุงุชูุญ ุณุฑูุฉ.  
* ุงูุญุฏ ุงูุฃุฏูู ูู ุงููPII ูู ุงูุฐุงูุฑุฉ ูุงูุชุฎุฒูู.  
* ุฅุฎูุงุก/ุชูููู ุธููุฑ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ ูู **ุงูุณุฌูุงุช (Logs)**ุ **ุญุธุฑ** ุทุจุงุนุฉ ุงูุชููู ุฃู ุงููheaders.

### **G) ุงูุณููู ุนูู ุงูุดุงุดุฉ**

* (ุงุฎุชูุงุฑู ุญุณุจ ุงูุญุงุฌุฉ) ููุน ููุทุงุช ุงูุดุงุดุฉ ูู ุดุงุดุงุช ุญุณูุงุณุฉ (Android FLAG\_SECURE).  
* ุฅุฎูุงุก ุงูุญููู ุงูุญุณุงุณุฉ ุนูุฏ ุงูุงูุชูุงู ููุฎูููุฉ (Blur View ุนูุฏ ุงููApp Switcher) โ ุญุณุจ ุงูุณูุงุณุฉ.

### **H) ุตูุงุญูุงุช ุงููุธุงู (Permissions)**

* ุทูุจ ุงูุญุฏ ุงูุฃุฏูู ูู ุงูุตูุงุญูุงุช ูุจุงูุฒูู ุงูููุงุณุจ (Just-in-time).  
* ุดุฑูุญุงุช ุนุฑุจูุฉ ูุงุถุญุฉ ูุณุจุจ ุทูุจ ุงูุตูุงุญูุฉ.

### **I) ุฅุฏุฎุงู ุงููุณุชุฎุฏู (Validation)**

* ุงูุชุญูู ูุญูููุง ูู ุชูุณููุงุช ุดุงุฆุนุฉ (ุงููุงุชู ุจุตูุบุฉ E.164ุ ุงูุญููู ุงููุทููุจุฉ).  
* Sanitization ูููุตูุต ุงูุญุฑูุฉ ูุจู ุงูุฅุฑุณุงู (ููุน ุฑููุฒ ุชุญูู/ุฃุทูุงู ุบูุฑ ููุทููุฉ).

### **J) ุงูุชุนุงูู ูุน ุงูุฃุฎุทุงุก**

* ุฑุณุงุฆู **ุนุงูุฉ** ูููุณุชุฎุฏูุฉ (ุจุฏูู ุชูุงุตูู ุชูููุฉ).  
* ุชุนููู ุฃููุงุฏ ุฏุงุฎููุฉ ููุฃุฎุทุงุก (mapping) ููุง ุชู ุชุนุฑููู ูุณุจููุง.  
* ุชุณุฌูู ุงูุฃุฎุทุงุก ุชููููุง ุฏุงุฎูููุง ุจุฏูู ุฃู PII.

### **K) ุญูุงูุฉ ุฅุฌุฑุงุกุงุช ุญุณูุงุณุฉ**

* ูุจู ุฅุฌุฑุงุกุงุช ูุซู **ุญุฐู ุงูุญุณุงุจ/ุชุบููุฑ ุฑูู ุงููุงุชู**: ุฅุนุงุฏุฉ ุชุญูู (Re-auth) ููุงุฌูุฉ ุชุฃููุฏ ูุฒุฏูุฌ.  
* **Checkout/Payment**: ุฅูุดุงุก **Idempotency-Key** ุนูู ุงูุฌูุงุฒ ููู ุนูููุฉ ูุฅุฑุณุงูู ูุน ุงูุทูุจ (ูุชูุงุฏู ุงูุชูุฑุงุฑ ุนูุฏ ุถุนู ุงูุดุจูุฉ).

---

## **Definition of Done (ุงุนุชูุงุฏ)**

* ุฌููุน ุทูุจุงุช ุงูุดุจูุฉ ุชุฑูู `Authorization` (+ `X-App-Check` ุนูุฏ ุงูุชูุนูู).  
* ุงูุฑููุฒ ูุฎุฒููุฉ ูู Keychain/Keystoreุ ูุชููุณุญ ููููุง ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ.  
* ุงูุงุชุตุงูุงุช HTTPS ุตุงุฑูุฉุ (ุฅู ููุนูู) SSL Pinning ูุนูู ุฏูู ูุณุฑ ุงูุชุฏูู.  
* Deep Links ุชุนูู ููุท ูู ูุทุงูุงุช ููุซููุฉุ ููุน ูุญุต ูุนููุงุช ุขูู.  
* ูุง ูุฌูุฏ ูุชูููุงุช/PII ูู ุงูุณุฌูุงุชุ ูุชู ุชูุนูู Redaction ููููุฌุงุช.  
* ุนูุฏ ุงูุชูุงุก ุงูุฌูุณุฉ ุชุธูุฑ ุฑุณุงูุฉ ุฏุฎูู ููุญูุฏุฉ ูุงูุชุทุจูู ูุญูู ุงููุณุชุฎุฏู ูุณูุงู ุขูู.  
* ุฅุฌุฑุงุกุงุช ุญุณูุงุณุฉ ุชุชุทูุจ re-auth ูุชุฃููุฏูุง ุฏุงุฎู ุงููุงุฌูุฉ.  
* Idempotency-Key ููุฑุณู ูู ูุณุงุฑุงุช ุงูุดุฑุงุก/ุงูุฏูุน ูุชู ุงุฎุชุจุงุฑ ุชูุฑุงุฑ ุงูุทูุจ.

---

## **ุชุณูููุงุช**

* **SecurityConfig**: ุฅุนุฏุงุฏุงุช ุงูุดุจูุฉ (TLS ููุทุ ูููุงุชุ Backoff).  
* **TokenStore**: ุทุจูุฉ ุชุฎุฒูู ุขูู ููุฑููุฒ ูุน ูุงุฌูุฉ (get/set/clear).  
* **AppCheckInterceptor**: ุฅุถุงูุฉ ุชุฑููุณุฉ App Check ุชููุงุฆููุง.  
* **DeepLinkGuard**: ุทุจูุฉ ุชุญูู ููุทุงูุงุช ููุนููุงุช ุงูุฑูุงุจุท.  
* **LogRedactor**: ุฃุฏุงุฉ ูุฅุฎูุงุก ุงูุญุณุงุณููุงุช ูู ุงูุณุฌูุงุช.  
* **SecureCache**: ูุงุฌูุฉ ูุชุฎุฒูู ูุญูู ูุดูุฑ ููุง ููุฒู (ุฅู ุชูุฑุฑูุง ุชุดููุฑ ุนูุงุตุฑ ูุนููุฉ).  
* ูุซููุฉ **Permissions Policy** (ูุง ุงูุฐู ูุทูุจู ูููุงุฐุง ููุชู).  
* **ุงุฎุชุจุงุฑุงุช**:  
  * ุงูุชูุงุก ุฌูุณุฉ โ ุฅุนุงุฏุฉ ุชูุฌูู ุตุญูุญุฉ.  
  * ุชุณุฌูู ุฎุฑูุฌ โ ูุณุญ ุชุงู ููุฑููุฒ ูุงููุงุด.  
  * Deep Link ุบูุฑ ููุซูู โ ููููุน ุจุฃูุงู.  
  * (ุฅู ููุฌุฏ) SSL Pinning โ ูุดู ุงูุดูุงุฏุฉ ุงููุฒููุฑุฉ ูููุน ุงูุงุชุตุงู.  
  * ุฅุฑุณุงู Idempotency-Key ูุชุฃููุฏ ููุน ุงูุชูุฑุงุฑ.

---

## **ุฃุฎุทุงุก ูุฌุจ ุชุฌูุจูุง**

* ุชุฎุฒูู ุงูุชููู ูู SharedPreferences/NSUserDefaults ุจุฏูู ุชุดููุฑ.  
* ุทุจุงุนุฉ ุงูุชููู/ุงูููุฏุฑ ูู ุงููLogs ุฃู ุฅุฑุณุงููุง ูุชุญูููุงุช.  
* ูุจูู ุฃู Deep Link ุจูุง ุชุญูู ูุทุงู/ูุนููุงุช.  
* ุฑุณุงุฆู ุฎุทุฃ ุชูุตุญ ุนู ุชูุงุตูู ุณูุฑูุฑ/ุงุณุชุซูุงุกุงุช.  
* ุชุฌุงูู ูุณุญ ุงููุงุด ุงูุญุณุงุณ ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ.  
* ุงุณุชุฏุนุงุก Checkout/Payment **ุจุฏูู** Idempotency-Key.

---

## **ููุงุญุธุงุช ุชุดุบูููุฉ (ููุชูุณูู ูุน ุงููBackend)**

* ูู ุงูุฑุฏ ุนูู 401/403: ุงุฑุฌุงุน ููุฏ ูุงุถุญ ููููู ุงูุนููู ุฃูู ูุญุชุงุฌ ุชุณุฌูู ุฏุฎูู.  
* ุชูุนูู **Rate Limiting** ู**WAF** ูู ุงูุฎุงุฏูุ ุงูุนููู ูุทุจูู Backoff ููุญุชุฑู 429\.  
* ุงุนุชูุงุฏ **ุณูู ุฃุญุฌุงู JSON** ูุน ุฑุณุงุฆู ูููููุฉ ุฅุฐุง ุชู ุชุฌุงูุฒู.  
* ุชูุญูุฏ ุฃููุงุฏ ุงูุฃุฎุทุงุก (ZH-XXXX) ูุน ุฌุฏูู ุงููmapping ูู ุงูุชุทุจูู.

---

## **1\. SecurityConfig**

**ุงูุงุณุชูุงุฏุฉ:** ูุถูู ุฃู ูู ุงูุงุชุตุงูุงุช ูุน ุงูุฎุงุฏู ุขููุฉ (HTTPS ููุท) ูุน ูููุงุช ูุถุจุท ูุญุงููุงุช ุฅุนุงุฏุฉ ุงูุทูุจ.  
**ุงูุทุฑููุฉ:** ุฅุนุฏุงุฏ ุนููู ุงูุดุจูุฉ (HttpClient/Retrofit/Alamofire) ูููุจู TLS ููุทุ ูุฑูุถ ุงูุดูุงุฏุงุช ุบูุฑ ุงูููุซููุฉุ ูุน ูููุฉ (Timeout) ูุญุฏุฏุฉ \+ ุณูุงุณุฉ Backoff ุนูุฏ ุงููุดู.

**2\. TokenStore**

**ุงูุงุณุชูุงุฏุฉ:** ุญูุงูุฉ ุฑููุฒ ุงูุฏุฎูู (Tokens) ูููุน ุณุฑูุชูุง ุฃู ูุฑุงุกุชูุง ูู ุชุทุจููุงุช ุฃุฎุฑู.  
**ุงูุทุฑููุฉ:** ุชุฎุฒูู ุงูุฑููุฒ ุฏุงุฎู Keychain (iOS) ุฃู Keystore/EncryptedSharedPrefs (Android). ูุณุญูุง ุชููุงุฆููุง ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ.

## **3\. AppCheckInterceptor**

**ุงูุงุณุชูุงุฏุฉ:** ุงูุชุฃูุฏ ุฃู ุงูุทูุจุงุช ุชุฃุชู ูู ุชุทุจูู โุฒูุฑุงุกโ ุงูุญูููู ููุทุ ูุชูููู ุงููุฌูุงุช ุงูุขููุฉ.  
**ุงูุทุฑููุฉ:** ุฅุถุงูุฉ Interceptor ูู ุนููู ุงูุดุจูุฉ ูุฅุฑุณุงู Header:

`X-App-Check: <token>`

ูุน ูู ุทูุจุ ูุงูุชุญูู ูู ุฑุฏ ุงูุฎุงุฏู ุนูุฏ ุงููุดู.

**4\. DeepLinkGuard**

**ุงูุงุณุชูุงุฏุฉ:** ููุน ุฃู ุฑุงุจุท ูุฒูู ูู ูุชุญ ุงูุชุทุจูู ุฃู ุฅุฏุฎุงู ููู ุถุงุฑุฉ.  
**ุงูุทุฑููุฉ:** ุชุญุฏูุฏ ูุงุฆูุฉ ูุทุงูุงุช ูุณููุญุฉ (whitelist ูุซู `zahraah.com`) \+ ูุญุต ุงููุนููุงุช ูุจู ุงูุชููู. ุฑูุงุจุท ุบูุฑ ูุทุงุจูุฉ โ ุชุนุฑุถ ุดุงุดุฉ ุขููุฉ ุจุฑุณุงูุฉ ุฎุทุฃ.

**5\. LogRedactor**

**ุงูุงุณุชูุงุฏุฉ:** ุญูุงูุฉ ุงูุณุฌูุงุช (Logs) ูู ุชุณุฑุจ ุจูุงูุงุช ุญุณุงุณุฉ ูุซู ุงูุฑููุฒ ุฃู ุงูุฃุฑูุงู.  
**ุงูุทุฑููุฉ:** ุฅูุดุงุก ุฃุฏุงุฉ (Utility) ุชุณุชุจุฏู ุงูููู ุงูุญุณุงุณุฉ ุจู `***` ุนูุฏ ุงูุทุจุงุนุฉ ุฃู ุงูุฅุฑุณุงู ููCrashlytics.

## **6\. SecureCache**

**ุงูุงุณุชูุงุฏุฉ:** ุญูุงูุฉ ุงูุจูุงูุงุช ุงููุญููุฉ (ูุซู ุงูุนูุงููู ุฃู ุงูุณูุฉ) ูู ุงููุตูู ุบูุฑ ุงููุตุฑุญ ุจู.  
**ุงูุทุฑููุฉ:** ุงุณุชุฎุฏุงู ุชุฎุฒูู ูุดูุฑ (EncryptedSharedPrefs/SQLCipher) ูุชุฎุฒูู ุงูุจูุงูุงุช ุงูุญุณุงุณุฉุ ูุน ุชูุธูููุง ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ.

## **7\. Permissions Policy**

**ุงูุงุณุชูุงุฏุฉ:** ุชูููู ุฑูุถ ุงูุชุทุจูู ูู ุงููุชุงุฌุฑ ูุฒูุงุฏุฉ ุซูุฉ ุงููุณุชุฎุฏู ุนุจุฑ ุทูุจ ุฃูู ุตูุงุญูุงุช ูุจุดูุงููุฉ.  
**ุงูุทุฑููุฉ:** ูุชุงุจุฉ ููู `Permissions.md` ููุถุญ:

* ูุง ูู ุงูุตูุงุญูุฉุ (ูุซุงู: ุงููุงููุฑุง)  
* ููุงุฐุง ูุทูุจูุงุ (ุฑูุน ุตูุฑุฉ ุงูููู ุงูุดุฎุตู)  
* ูุชู ูุทูุจูุงุ (ุนูุฏ ุงูุญุงุฌุฉ ููุท โ Just-in-time).

**8\. Idempotency in Checkout/Payment**

**ุงูุงุณุชูุงุฏุฉ:** ููุน ุชูุฑุงุฑ ุงูุทูุจ ุฃู ุงูุฏูุน ุนูุฏ ุถุนู ุงูุฅูุชุฑูุช ุฃู ุฅุนุงุฏุฉ ุงููุญุงููุฉ.  
**ุงูุทุฑููุฉ:** ุฅูุดุงุก ููุชุงุญ ูุฑูุฏ `Idempotency-Key` ุนูุฏ ูู ุนูููุฉ Checkout/Payment ูุฅุฑุณุงูู ูู Headerุ ููุชุญูู ุงูุฎุงุฏู ุฃู ุงูุนูููุฉ ูุง ุชูููุฐ ูุฑุชูู.


---

## ๐ **Back to Home | ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ**

[โ Back to Main Index | ุงูุนูุฏุฉ ููููุฑุณ ุงูุฑุฆูุณู](../../../index.html)

---
