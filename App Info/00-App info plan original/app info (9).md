# **4\) الخدمات الداخلية داخل التطبيق (Auth, Notifications, Remote Config, Analytics)**

## **A) المصادقة (Authentication)**

**الفائدة:**

* ربط كل مستخدم بحساب موثوق.  
* تمكين السلة، المفضلة، الطلبات.  
* زيادة الأمان ومنع الوصول المجهول.

**المطلوب:**

* تسجيل الدخول برقم الهاتف \+ OTP (أساسي).  
* دعم البريد/كلمة المرور (اختياري).  
* توحيد الجلسة عبر Firebase Auth Token.  
* عند انتهاء الجلسة → إعادة توجيه لشاشة الدخول.  
* إمكانية ربط الحساب (هاتف \+ بريد).

**Definition of Done:**

* تسجيل/تسجيل دخول يعمل 100%.  
* OTP يعمل مع إعادة الإرسال \+ مؤقت.  
* تجديد الجلسة يتم تلقائيًا.  
* رسالة موحّدة عند انتهاء الجلسة.

**تسليمات:**

* شاشة تسجيل دخول/OTP.  
* Service خاص بالمصادقة.  
* اختبارات دخول/خروج ناجح وخاطئ.

**أخطاء يجب تجنبها:**

* تخزين الرموز أو كلمات المرور مكشوفة.  
* السماح باستخدام التطبيق بعد تسجيل الخروج.  
* تجاهل إعادة المحاولة عند إرسال OTP.

---

## **B) الإشعارات (Push Notifications)**

**الفائدة:**

* إعادة تنشيط المستخدم (عروض، منتجات جديدة).  
* إشعارات تشغيلية (نجاح الطلب، تحديث الشحن).

**المطلوب:**

* تسجيل `fcm_token` مع بيانات الجهاز.  
* دعم إشعارات تشغيلية \+ ترويجية.  
* التعامل مع الإشعارات: foreground → In-App Banner / background → Notification Tray.  
* Deep Link لفتح الشاشة المناسبة.

**Definition of Done:**

* تسجيل/حذف token يعمل.  
* إشعار تجريبي يظهر في foreground \+ background.  
* يفتح الشاشة الصحيحة عند الضغط.

**تسليمات:**

* كود تسجيل الجهاز مع API.  
* مكوّن In-App Banner.  
* جدول mapping بين نوع الإشعار والشاشة.

**أخطاء يجب تجنبها:**

* تكرار token لنفس الجهاز.  
* عدم تحديث/حذف token عند الخروج.  
* إرسال إشعارات بدون صلاحيات.

---

## **Remote Config (C**

**الفائدة:**

* تفعيل/إيقاف ميزات بدون تحديث التطبيق.  
* تجارب A/B سريعة.

**المطلوب:**

* ربط مع Firebase Remote Config.  
* إعداد قيم افتراضية محلية.  
* تطبيق التغييرات فورًا أو عند إعادة فتح التطبيق.  
* أمثلة: عرض Banner جديد، إخفاء ميزة الدفع المسبق.

**Definition of Done:**

* قيم افتراضية موجودة وتعمل بدون إنترنت.  
* أي تغيير من Firebase يظهر خلال ≤ 1 دقيقة.  
* يتم تسجيل التغييرات في Analytics.

**تسليمات:**

* ملف ConfigService.  
* متغيرات واضحة (مثل: `show_cod_banner`, `enable_prepaid`).  
* أمثلة اختبارية: إخفاء/إظهار عنصر.

**أخطاء يجب تجنبها:**

* عدم وجود قيم افتراضية محلية.  
* الحاجة لإعادة تنصيب التطبيق للتغيير.  
* تجاهل تسجيل التغييرات في Analytics.

---

## **Analytics (D**

**الفائدة:**

* تتبع سلوك المستخدمين.  
* قياس الحملات التسويقية.  
* اكتشاف مشاكل الاستخدام مبكرًا.

**المطلوب:**

* ربط GA4 \+ Firebase Analytics.  
* إطلاق أحداث قياسية (screen\_view, view\_item, add\_to\_cart, purchase).  
* إطلاق أحداث مخصّصة (coupon\_applied, cod\_selected).  
* User Properties (اللغة، المدينة، نوع الدفع المفضل).

**Definition of Done:**

* كل شاشة تطلق `screen_view`.  
* الأحداث الرئيسية تُسجّل مع القيم المالية.  
* User Properties تظهر في لوحة GA4.

**تسليمات:**

* ملف AnalyticsService.  
* توثيق الأحداث والمعلمات.  
* اختبار داخلي عبر DebugView.

**أخطاء يجب تجنبها:**

* إرسال أحداث بدون معلمات أساسية.  
* ازدواج الأحداث عند التنقل بين الشاشات.  
* عدم استبعاد الأجهزة الداخلية من التتبع.


---

## 🏠 **Back to Home | العودة للرئيسية**

[← Back to Main Index | العودة للفهرس الرئيسي](../../../index.html)

---
