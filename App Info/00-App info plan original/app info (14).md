# **الملاحظات الخاصة بالشبكة (Networking)**

## **1\) إعادة المحاولة (Retry)**

* **الحاجة**: في السوق المحلي غالبًا الإنترنت ضعيف أو غير مستقر.  
* **الإضافة المطلوبة**:  
  * تفعيل **Exponential Backoff** (تأخير متزايد بين المحاولات).  
  * عدد محاولات قصوى (مثال: 3 مرات).  
  * استخدام Dio Interceptor لإعادة الطلبات الفاشلة تلقائيًا.  
  * تسجيل السبب في Crashlytics أو Sentry عند الفشل النهائي.

---

## **2\) مراقبة الاستهلاك (Network Monitoring)**

* **الحاجة**: لتقليل استهلاك البيانات عند العملاء.  
* **الإضافة المطلوبة**:  
  * قياس حجم الاستهلاك لكل عملية API.  
  * عرض خيار **“وضع توفير البيانات”** (Data Saver Mode): تحميل صور منخفضة الجودة \+ تقليل طلبات الخلفية.  
  * Analytics event: `data_saver_enabled` (true/false).

---

## **3\) التعامل مع الانقطاع (Offline Mode)**

* **الحاجة**: الإنترنت قد ينقطع بشكل متكرر.  
* **الإضافة المطلوبة**:  
  * **Queue** للعمليات (إضافة للسلة، تعديل العنوان، المفضلة) تُرسل عند عودة الاتصال.  
  * كاش محلي للصفحات المهمة (Catalog, Cart, Orders).  
  * شاشة “أنت غير متصل” برسالة واضحة وزر إعادة المحاولة.

---

## **4\) إدارة الجلسة (Session Handling)**

* **الحاجة**: الحفاظ على أمان الحساب مع انقطاع الشبكة أو تغيير الاتصال.  
* **الإضافة المطلوبة**:  
  * تحديث تلقائي للـAccess Token عند انتهاء صلاحيته.  
  * إذا فشل التحديث → تسجيل خروج نظيف مع إشعار المستخدم.  
  * إلغاء الطلبات المعلّقة (Cancel Tokens) عند فقد الاتصال.

---

## **5\) الأخطاء الموحدة (Network Error Mapping)**

* **الحاجة**: توحيد تجربة المستخدم عند حدوث مشاكل.  
* **الإضافة المطلوبة**:  
  * **Timeout** → “الخدمة بطيئة، جرّب لاحقًا”.  
  * **No Connection** → “تأكد من اتصال الإنترنت”.  
  * **Server Error (5xx)** → “مشكلة في السيرفر، فريقنا يعمل على حلها”.  
  * **Unauthorized (401)** → إعادة تسجيل الدخول.  
  * **Conflict (409)** → معالجة حالة نفاد المخزون أو تحديث السعر.

---

## **6\) الأمان (Security Layer)**

* **الحاجة**: ضمان أمان الطلبات.  
* **الإضافة المطلوبة**:  
  * دعم **TLS Pinning** (إذا أمكن).  
  * التحقق من صحة الردود (schema validation).  
  * منع تسجيل البيانات الحساسة في الـLogs.


---

## 🏠 **Back to Home | العودة للرئيسية**

[← Back to Main Index | العودة للفهرس الرئيسي](../../../index.html)

---
