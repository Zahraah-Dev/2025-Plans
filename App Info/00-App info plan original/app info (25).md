# **Redis Standards** 

## **0\) ุงููุทุงู**

* **ุงูุบุฑุถ:** ุชุณุฑูุน ุงููุฑุงุกุฉุ ุงูุญูุงูุฉ (rate limiting)ุ ุงูุฃููุงู ุงูููุฒุนุฉุ ูุงูุฌูุณุงุช ุงูุฎูููุฉ.  
* **ููุณ ูุตุฏุฑ ุญูููุฉ:** ูุง ุชูุฎุฒููู ุจูุงูุงุช ุงูุฃุนูุงู ุงูุญุณุงุณุฉ ููุตุฏุฑ ููุงุฆู.

---

## **1\) ุงูุชูุฒูุน ูุงูุชุดุบูู (Topology)**

* ุจูุฆุงุช ูููุตูุฉ: `dev`, `staging`, `prod`.  
* ูุซููุงู (ูุณุชุญุณู):  
  * **cache** (ุจุฏูู AOFุ ุณูุงุณุฉ ุฅุฎูุงุก `allkeys-lru`).  
  * **state** (AOF=on ููุฃูุงู ููุฌูุณุงุช/ุงููููุฏ/ุงูุฃููุงู).  
* **ุงูุชูููุฑ ุงูุนุงูู:**  
* Managed (ElastiCache/Redis Cloud/Upstash) ุฃู Self-Hosted ูุน Sentinel (Master \+ Replica).

---

## **2\) ุงูุชุณููุฉ ุงููุนูุงุฑูุฉ ููููุงุชูุญ (Key Naming)**

{app}:{env}:{domain}:{entity}:{id}:{sub}  
ูุซุงู: zahraah:prod:product:12345

* ููุงุฆู ุจููุงุชุฑ/ุชุฑุชูุจ/ุตูุญุฉ ุถูู ุงูููุชุงุญ: `zahraah:prod:category:{cid}:list:p{n}:sort:{s}`

---

## **3\) ุณูุงุณุฉ TTL**

* ูู ููุชุงุญ **ูู TTL** ููุงุณุจ ูุงุณุชุฎุฏุงููุ ูุน **Jitter ยฑ10โ20%** ูุชุฌูุจ ุงูุชูุงุก ุฌูุงุนู.  
* ูุฑุฌุน ุณุฑูุน:  
  * ุงูููุชุฌ: 5โ15 ุฏูููุฉ  
  * ููุงุฆู ุงููุฆุงุช: 1โ5 ุฏูุงุฆู  
  * ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ: 30โ60 ุซุงููุฉ  
  * ููุงุนุฏ ุงูุดุญู/ุงูุชุณุนูุฑ: 5โ30 ุฏูููุฉ  
  * ุงูููุจููุงุช: 2โ10 ุฏูุงุฆู

## **4\) ููุท Cache-Aside ุงูููุงุณู**

**ูุฑุงุกุฉ:**

1. Get โ ุฅุฐุง Hit ุฃุนุฏ ุงููููุฉ.  
2. ุฅุฐุง Miss: ุงุณุชุนูู MySQL โ Set ูุน TTL โ ุฃุนุฏ ุงููููุฉ.

**ูุชุงุจุฉ:**

* ูููุฐ ุงููุนุงููุฉ ูู MySQL.  
* ุจุนุฏ **ูุฌุงุญ commit**: ุฅุจุทู (DEL) ุงูููุงุชูุญ ุฐุงุช ุงูุตูุฉุ ูุงูุดุฑ ุญุฏุซ `cache:invalidate` (Pub/Sub) ูุน ูุงุฆูุฉ ุงูููุงุชูุญ/ุงูุฃููุงุท.  
* ุงุญูู ูู **Cache Stampede** ุนุจุฑ Lock (SET NX \+ TTL ูุตูุฑ).

---

## **5\) ุฎุฑุงุฆุท ุงูุฅุจุทุงู (ุชููุณููู ูุน ูุฑูู DB)**

* **product/variant:**  
  * DEL `zahraah:prod:product:{product_id}`  
  * DEL `zahraah:prod:category:{cid}:list:*` ุฐุงุช ุงูุตูุฉ  
* **category:**  
  * DEL `zahraah:prod:category:{cid}:list:*`  
  * DEL `zahraah:prod:home`  
* **pricing/shipping:**  
  * DEL `zahraah:prod:shipping:city:*`  
* **coupon:**  
  * DEL `zahraah:prod:coupon:{code}`  
* **inventory:**  
  * DEL `zahraah:prod:product:{product_id}` (+ ููุงุฆู ุฐุงุช ุตูุฉ)


ุงููุตุฏุฑ ุงูููุงุฒู ููุฌูุฏ ูู ููู ยซูุนุงููุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุชยป โ ุญุงูุธูุง ุนูู ุชุทุงุจู ุงูุชุณููุฉ.

---

## **6\) ุงููููุฏ ูุงูุญูุงูุฉ**

* **Rate Limiting (OTP/Login):** ููุงุชูุญ ูุงูุฐุฉ ููุฒููุฉ (Sliding Window) ููู ุฑูู ุฃู IP.  
* **Locks:**  
  * ุนูููุงุช ุญุณุงุณุฉ (ููุจููุงุชุ ุฅูุดุงุก ุงูุทูุจ) ุนุจุฑ `SET key value NX EX {ttl_s}`.  
  * ุฅุนุงุฏุฉ ุงููุญุงููุฉ ูุน backoff ุจุณูุท ุนูุฏ ูุดู ุงูุญุตูู ุนูู ุงูููู.  
* **Sessions/Tokens:** ุฅู ูู ุชูู JWT ูุงููุฉุ ุฎุฒู ุงูุญุฏ ุงูุฃุฏูู ุจTTL ููุงุณุจ.

---

## **7\) ุงูุฅุนุฏุงุฏ ูุงูุชููุฆุฉ (Config)**

* ูุฑุงุกุฉ ุงูุฅุนุฏุงุฏ ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ: `REDIS_URL`, `REDIS_TLS`, `REDIS_DB_CACHE`, `REDIS_DB_STATE`.  
* ูููุฉ ุฃูุงูุฑ ุงูุชุฑุงุถูุฉ 50โ200msุ ูุฅูุบุงุก (timeout) ุนูุฏ ุงูุชุฌุงูุฒ.  
* ุงูุชุจุณ ุงูููู ุงูุซูุงุฆูุฉ/JSON ุจุณูุงุณู UTF-8.

---

## **8\) ุงููุฑุงูุจุฉ (Observability)**

* **ูุคุดุฑุงุช ุฃุณุงุณูุฉ:** Hit Ratio (\>0.9 ูุฏู ูููุงุด ุงูุดุงุฆุน)ุ Latencyุ Evictionsุ Memory Fragmentation.  
* **Slowlog:** ููุนูู ูุชุญููู ุฏูุฑู.  
* **ููุญุฉ ูุฑุงูุจุฉ:** ุฃุนูู ุงูููุงุชูุญ ูุตูููุง/ุญุฌููุง \+ ุฃุฎุทุงุก ุงูุงุชุตุงู.

---

## **9\) ุงูุฃูู**

* ุดุจูุฉ ุฎุงุตุฉ ููุท (VPC/VNet) \+ TLS ุนูุฏ ุงูุนุจูุฑ ุจูู ุงูุดุจูุงุช.  
* ูููุงุช ูุฑูุฑ ูููุฉ \+ ACLุ ูุชุนุทูู ุฃู ุชูููุฏ ุฃูุงูุฑ ุญุณุงุณุฉ (`FLUSHALL`, `CONFIG`).

---

## **10\) ุฃูุซูุฉ ุดุจู-ููุฏ (Pseudocode)**

**ูุฑุงุกุฉ ููุชุฌ:**

val \= redis.get(key)  
if (\!val) {  
  val \= db.fetchProduct(id)  
  redis.set(key, val, TTL+Jitter)  
}  
return val

**ุชุญุฏูุซ ููุชุฌ:**

transaction {  
  db.updateProduct(p)  
}  
redis.del(productKey)  
redis.publish('cache:invalidate', \[productKey, relatedCategoryListPattern\])

**ููู ููุจูู:**

if (redis.set(lockKey, reqId, NX, EX=20)) {  
  // safely redeem  
  try { redeem(); }  
  finally { if (redis.get(lockKey)==reqId) redis.del(lockKey) }  
} else {  
  throw BusyError  
}

---

## **11\) ูุนุงููุฑ ุงููุจูู (App)**

1. ุงูุชุฒุงู ุงูุชุณููุฉ ูุงููTTL ูุงูุฌูุชุฑ.  
2. ูุณุงุฑุงุช ุงููุชุงุจุฉ ุชูุจุทูู ุงูููุงุชูุญ ุจุนุฏ commit ููุท.  
3. ุญูุงูุฉ Stampede ุจุงูููู.  
4. ูุฑุงูุจุฉ Hit Ratio/Evictions/Latency ูุชุงุญุฉ ูููุฑูู.  
5. ุงุฎุชุจุงุฑุงุช ุชูุงูู ุชูุซุจุช ุงูุฅุจุทุงู ูููุงุฆู ููุฑุฏูุงุช ุงูููุชุฌ ูุงูููุจููุงุช ูุงูุดุญู.

## **12\) ุฎุทุฉ ุทูุงุฑุฆ ูุฎุชุตุฑุฉ (Runbook)**

* ุงุฑุชูุงุน evictions: ุฑุงุฌุน TTL/ุงูุณุนุฉ ุฃู ูุณูุน ุงูุฐุงูุฑุฉ.  
* Hit Ratio ููุฎูุถ: ุชุฃูุฏ ูู ุงูุชุณููุฉ/ุงูุชุฎุฒููุ ุฑุงุฌุน ุนุฏู ูุฌูุฏ Miss ูุชูุฑุฑ ุจุณุจุจ Jitter ููุฑุท.  
* Latency ูุฑุชูุน: ุชุญูู ูู ุงูุดุจูุฉุ CPUุ Slowlogุ ูุญุฌู ุงูููู.


---

## ๐ **Back to Home | ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ**

[โ Back to Main Index | ุงูุนูุฏุฉ ููููุฑุณ ุงูุฑุฆูุณู](../../../index.html)

---
