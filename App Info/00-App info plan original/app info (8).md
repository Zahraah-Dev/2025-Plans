# **3\) ุทุจูุฉ ุงูุจูุงูุงุช (Repositories \+ API Client \+ Cache)**

## **ููุงุฐุง (ุงููุงุฆุฏุฉ)**

* ูุงุฌูุฉ ููุญูุฏุฉ ูููุตูู ููุจูุงูุงุช ุจุบุถู ุงููุธุฑ ุนู ูุตุฏุฑูุง (ุดุจูุฉ/ูุญูู).  
* ุชูููู ุงูุนูู **ุฃูููุงูู ุฌุฒุฆู** ูุชุญุณูู ุณุฑุนุฉ ุงูุชุทุจูู.

## **ูุง ุงููุทููุจ ุชูููุฐู**

* **Repository ููู ูุฌุงู:** `ProductsRepository, CartRepository, OrdersRepository, AuthRepositoryโฆ`  
* **RemoteDataSource:** ุนููู REST ููุญูุฏุ ุชุฑููุณุงุช ุซุงุจุชุฉ (Authorization, App-Check, Request-Id)ุ ุชุฑููู ุตูุญุงุชุ ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุนูุงุฑูุฉ.  
* **LocalDataSource (Cache):**  
  * Cache ููู Lists (ุงูุตูุญุฉ ุงูุฃููู ุนูู ุงูุฃูู) \+ ุชูุงุตูู ุงูููุชุฌ.  
  * ุชูุถููุงุช ุฎูููุฉ (ุงููุบุฉ/ุงูุนููุฉ/ุงููุณุชุฎุฏู) ูู ุชุฎุฒูู ูุญูู ุขูู.  
* **ุณูุงุณุฉ ุงูุชุญุฏูุซ:** **Stale-While-Revalidate**  
  * ุงุนุฑุถ ุงููุงุด ููุฑูุงุ ูุฌุฏูุฏ ูู ุงูุดุจูุฉ ุจุงูุฎูููุฉุ ูุญุฏูุซ ุงููViewModel ุนูุฏ ูุตูู ุงูุจูุงูุงุช.  
* **ุงูููุงุฐุฌ (Models):**  
  * **Domain Models** ูุง ุชุนุชูุฏ ุนูู JSON.  
  * **DTOs** ููุชุญููู ูู/ุฅูู ุงููAPI ููุท (Mapper ูุงุถุญ ุจููููุง).  
* **ุงูุชุนุงูู ูุน ุงูุฃุฎุทุงุก:** ุชุญููู ุฃููุงุฏ ุงูุดุจูุฉ ุฅูู ุฃุฎุทุงุก ูุฌุงู ูููููุฉ (ูุซูุงู ZH-VALID-422 โ ุฎุทุฃ ุฅุฏุฎุงู).  
* **ุงูุฃูุงู:** ุญูุธ ุงูุฑููุฒ (Tokens) ูุญูููุง ุจุดูู ุขููุ ูุชูุธูููุง ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ.

## **Definition of Done (ุงุนุชูุงุฏ)**

* ุนููู API ููุญูุฏ ูุนูู ูุน Timeouts ูRetry ูุญุฏูุฏ.  
* Repositories ูุนูุงูุฉ ูุดุงุดุงุช: ูุงุฆูุฉ ุงูููุชุฌุงุชุ ุชูุงุตูู ููุชุฌุ ุงูุณูุฉุ ุงูุทูุจ.  
* Cache ูุนูู ููุธูุฑ ูุฑู ุงูุณุฑุนุฉ ุจูู ุงููุชุญ ุงูุฃูู ูุงูุซุงูู.  
* ุชุญููู DTO โ Domain ุนุจุฑ Mapper ููุฎุชุจุฑ.  
* ุชุบุทูุฉ ุฃุฎุทุงุก ุงูุดุจูุฉ ุดุงููุฉ (ุนุฏู ูุฌูุฏ ุฅูุชุฑูุช/ูููุฉ/422/401โฆ)ุ ูุงููUI ุชุนุฑุถ ุฑุณุงุฆู ุนุฑุจูุฉ ููุงุณุจุฉ.

## **ุชุณูููุงุช**

* ุฌุฏูู Endpoints ุงูุฃุณุงุณูุฉ ุงููุทููุจุฉ (ุฃุณูุงุก ููุท ุงูุขูุ ุงูุชูุงุตูู ูุงุญููุง ูู ูุณุชูุฏ ุงููAPI).  
* ูุงุฆูุฉ DTOs \+ Domain Models ููู ููุฑุฏ.  
* ุณูุงุณุฉ ุงููCaching ููู ุดุงุดุฉ (ูุง ููุฎุฒููุ ูุฏุฉ ุงูุตูุงุญูุฉุ ูุชู ููุญุฏูุซ).  
* ุฎุฑูุทุฉ ุงูุฃุฎุทุงุก ูุชุญููููุง ูุฑุณุงุฆู ูุงุฌูุฉ.

## **ุฃุฎุทุงุก ุดุงุฆุนุฉ ูุฌุจ ุชุฌูุจูุง**

* ุงุณุชุฎุฏุงู ููุณ ุงููููุฐุฌ ููDomain ูDTO โ ุงูุตู ุจููููุง.  
* ุฅุดุบุงู ุงููUI ุจุงูุชุธุงุฑ ุงูุดุจูุฉ ุฏุงุฆููุง โ ุงูุชุญ ุจุงููุงุด ุซู ุญุฏูุซ.  
* ุชุฌุงูู ุงูุชุฑููู/ุงูููุชุฑุฉ ูู ุงูููุงุฆู โ ุงูุชุฒู ุจุนูุฏ ููุญูุฏ.

## **1\) ุฌุฏูู Endpoints ุงูุฃุณุงุณูุฉ ุงููุทููุจุฉ**

ุงูุบุฑุถ: ุงููุจุฑูุฌ ูุนุฑู ุฃู ูุณุงุฑุงุช API ุณูุจูู ุนูููุง ุงูุดุงุดุงุช. (ููุชุจูุง ุฃุณูุงุก ููุทุ ุงูุชูุงุตูู ุงูุฏูููุฉ ุชููู ูู ูุณุชูุฏ ุงููAPI ุงูุฑุณูู).

| ุงูุดุงุดุฉ / ุงูููุฒุฉ | Endpoint ุงูุฃุณุงุณู | ุงูููุงุญุธุงุช |
| ----- | ----- | ----- |
| ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ / ุงููุฆุงุช | `GET /categories` | ุฌูุจ ุงููุฆุงุช ูุน ุงูุตูุฑ |
| ูุงุฆูุฉ ุงูููุชุฌุงุช | `GET /products?category_id=...` | ูุน ุชุฑููู ุตูุญุงุช |
| ุชูุงุตูู ุงูููุชุฌ | `GET /products/{product_id}` | ูุชุถูู variants ูุงููุฎุฒูู |
| ุงูุจุญุซ | `GET /search?q=...` | ูุน ุนุฏุฏ ุงููุชุงุฆุฌ |
| ุงูุณูุฉ | `GET /cart`, `POST /cart/items` | ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ุนูุงุตุฑ |
| ุงููุณุงุฆู | `POST /coupons/validate` | ุฅุฑุฌุงุน ูููุฉ ูุตูุงุญูุฉ |
| ุงูุฏูุน / ุงูุดุฑุงุก | `POST /checkout` | ุญุฌุฒ ุงููุฎุฒูู ูุฅูุดุงุก order |
| ุงูุทูุจุงุช | `GET /orders`, `GET /orders/{id}` | ุงุณุชุฑุฌุงุน ุชุงุฑูุฎ ุงูุทูุจ |
| ุงูุฅุดุนุงุฑุงุช (ุชุณุฌูู ุฌูุงุฒ) | `POST /devices/register` | ูุญูุธ fcm\_token |

---

## **2\) ูุงุฆูุฉ DTOs \+ Domain Models ููู ููุฑุฏ**

* **DTO (Data Transfer Object):** ุงูุดูู ุงููุงุฏู ูู/ุฅูู ุงููAPI (JSON).  
* **Domain Model:** ุงููุงุฆู ุงูุฏุงุฎูู ุงูุฐู ูุณุชุฎุฏูู ุงูุชุทุจูู (ุฃุจุณุท/ุฃูุถุญ).

**`DTO:`**  
`{`  
  `"id": "123",`  
  `"name": "ูุณุชุงู ุชุฑูู",`  
  `"price": 12000,`  
  `"currency": "YER",`  
  `"images": ["..."],`  
  `"variants": [`  
    `{"id": "v1", "size": "M", "color": "Black", "stock": 3}`  
  `]`  
`}`

* 

**`Domain Model:`**  
`class Product {`  
  `final String id;`  
  `final String name;`  
  `final int price;`  
  `final String currency;`  
  `final List<String> images;`  
  `final List<Variant> variants;`

* `}`

---

## **3\) ุณูุงุณุฉ ุงููCaching ููู ุดุงุดุฉ**

ุชุญุฏุฏ **ูุงุฐุง ูุฎุฒู ูุญูููุง \+ ูุฏุฉ ุตูุงุญูุฉ ุงูุชุฎุฒูู \+ ูุชู ูุญุฏูุซ**.

| ุงูุดุงุดุฉ | ูุง ููุฎุฒู | ูุฏุฉ ุงูุตูุงุญูุฉ | ุณูุงุณุฉ ุงูุชุญุฏูุซ |
| ----- | ----- | ----- | ----- |
| ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ | ูุงุฆูุฉ ุงููุฆุงุช \+ ููุชุฌุงุช ุฃูููุฉ | 24 ุณุงุนุฉ | ุฌูุจ ูู ุงููุงุด ุฃูููุง ุซู ุชุญุฏูุซ ูู ุงูุดุจูุฉ ุจุงูุฎูููุฉ |
| ุชูุงุตูู ุงูููุชุฌ | ุจูุงูุงุช ุงูููุชุฌ \+ ุงูุตูุฑ | 12 ุณุงุนุฉ | ุฌูุจ ูู ุงููุงุด ุซู ุชุญุฏูุซ ุฅุฐุง ุชุบูุฑ ุงูุณุนุฑ/ุงููุฎุฒูู |
| ุงูุณูุฉ | ุนูุงุตุฑ ุงูุณูุฉ ูุญูููุง | ุฏุงุฆู (ุญุชู ุชุณุฌูู ุฎุฑูุฌ) | ููุฒุงูู ุนูุฏ ูู ุฏุฎูู ููุดุงุดุฉ |
| ุงูุทูุจุงุช | ุขุฎุฑ 5 ุทูุจุงุช | 1 ููู | ุชุญุฏูุซ ูุฏูู ุนุจุฑ ุณุญุจ ููุชุญุฏูุซ |

---

## 

## **4\) ุฎุฑูุทุฉ ุงูุฃุฎุทุงุก ูุชุญููููุง ูุฑุณุงุฆู ูุงุฌูุฉ**

ูุญุฏุฏ ููู ูุชุญูู ููุฏ ุงูุฎุทุฃ ูู ุงููAPI ุฅูู ุฑุณุงูุฉ ุนุฑุจูุฉ ูููููุฉ ุชุนุฑุถ ูู ุงูุชุทุจูู.

| ููุฏ ุงููAPI | error\_code ุฏุงุฎูู | ุงูุฑุณุงูุฉ ูููุงุฌูุฉ |
| ----- | ----- | ----- |
| HTTP 401 / ZH-AUTH | `auth_401` | **ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ูููุชุงุจุนุฉ.** |
| HTTP 422 / ZH-VALID | `validation_422` | **ุฑุฌุงุกู ุฑุงุฌุนู ุงูุจูุงูุงุช ุงููุฏุฎูุฉ.** |
| HTTP 404 | `not_found_404` | **ุงูุนูุตุฑ ุบูุฑ ูุชุงุญ ุงูุขู.** |
| HTTP 409 / ZH-INV | `conflict_409` | **ููุฏ ุงููุฎุฒูู ููุฐุง ุงูููุชุฌ.** |
| HTTP 500+ | `server_5xx` | **ุญุฏุซ ุฎุทุฃ ูุคูุช ูู ุงูุฎุงุฏู.** |
| Timeout / NoNetwork | `network_offline` | **ุงุชุตุงูู ุจุงูุฅูุชุฑูุช ุบูุฑ ูุชููุฑ.** |

---

๐ก**ุฎุงุฑุทุฉ ุทุฑูู ูุงุถุญุฉ**:

* ูุนุฑู ุฃู Endpoints ูุญุชุงุฌ ูุจูู ููุง ุงุณุชุฏุนุงุกุงุช.  
* ุนูุฏู Models ุฌุงูุฒุฉ ูููData.  
* ูุนุฑู ููู ูุฏูุฑ ุงููุงุด ููู ุดุงุดุฉ.  
* ุนูุฏู ุฌุฏูู ูุญููู ุฃู ุฎุทุฃ ุฅูู ุฑุณุงูุฉ ูุงุฌูุฉ ููุญุฏุฉ.  
* ูู ุทูุจ request ูุญุชูู ุนูู meta\_data ุญูู ูุนูููุงุช ุงูุฌูุงุฒ ูุงูุฌูุณุฉ


---

## ๐ **Back to Home | ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ**

[โ Back to Main Index | ุงูุนูุฏุฉ ููููุฑุณ ุงูุฑุฆูุณู](../../../index.html)

---
