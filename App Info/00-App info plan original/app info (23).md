1. جدول قيم الكاش ومدة الـTTL لكل شاشة ولكل Endpoint (مع سياسة SWR بالأرقام).

2. خريطة الروابط العميقة Deep/Universal Links (التحقق من النطاقات \+ fallback \+ سيناريوهات الاختبار).

3. قنوات/فئات الإشعارات وسياسات الإرسال (TTL, collapse\_key, quiet hours, opt-in/opt-out).

4. خريطة أخطاء Backend→UI موحّدة (أكواد، رسالة عربية، إجراء المستخدم، مستوى الشدة).

5. ميزانيات أداء إلزامية (App start/Screen load/FPS/Memory/App size وحدود الصور).

6. سياسة الصور والأصول (صيَغ، أبعاد قصوى، الضغط، CDN، lazy-loading، placeholders).

7. أمان متقدّم داخل التطبيق (SSL pinning، كشف root/jailbreak، حجب لقطات على الشاشات الحساسة).

8. سياسة السجلات Logging (مستويات، إطفاء بالإنتاج، إزالة البيانات الحساسة، correlation IDs، الاحتفاظ).

9. Runbooks تشغيلية للحوادث (أعطال/شبكة/بطء/فشل الدفع) مع عتبات تنبيه وإجراءات فورية.

10. خطّة CI/CD لـ iOS (macOS runner، التوقيع، أرقام البناء، TestFlight، توزيع مرحلي).

11. مصفوفة المنصات والأذونات (min/target SDK، iOS min، Privacy Manifest/Play Data Safety).

12. التحليلات والهوية: حفظ **أول وآخر مصدر** (UTM) \+ ربط user\_id \+ مخطط أحداث موحّد.

13. Feature Flags/Remote Config Playbook (قائمة الميزات الحرجة، التفعيل/الإرجاع، حراسة المخاطر).

14. إدارة الأسرار Secrets (dart-define/CI secrets، التناوب Rotation، عدم التسريب في السجلات).

15. مرونة الشبكة (Retry/Exponential Backoff، Circuit Breaker، مصفوفة Timeouts بحسب العملية).

16. بوابات جودة الإصدار Release QA Gates (checklist، golden thresholds، smoke/automation، staged rollout 

17. سياسة التبعيات الخارجية (تثبيت النسخ، تحديثات دورية، فحص أمن/ترخيص، بدائل عند الفشل).

18. سياسة البيانات المحلية (ما يُخزَّن، تشفير، مدة الاحتفاظ، إستراتيجية التنظيف/الترحيل).

19. الوصولية والـRTL الموسّعة (تباين، أحجام خط، TalkBack/VoiceOver، اختبارات pseudo-localization).

20. الامتثال والخصوصية داخل التطبيق (نصوص الموافقات Push/SMS/WhatsApp/Email، سياسة الخصوصية داخل التطبيق).

21. KPIs مستهدفة للواجهة (CTR البنرات، Add-to-Cart، Conversion، Checkout success، Retention) مع حدود تنبيه.

22. معايير التسمية Naming Conventions موحّدة (ملفات/مجلدات/Providers/UseCases/DTOs).

23. مصفوفة إعدادات البيئات (dev/stage/prod) في جدول واحد (baseUrls، featureFlags، logLevel…).

24. إدارة الإصدارات Versioning وChangelog إلزامي.

25. إستراتيجية Offline/Sync (حل تضارُب السلة والطلبات Last-write-wins أو دمج مُعرّف).

26. سياسة الشبكات الضعيفة (Prefetch، ضغط Gzip/Brotli، قيود الصور، fallbacks بلا إنترنت).

27. اختبار الأمان الدوري (قائمة MSTG-lite، نطاق Pen-Test، معالجة المخرجات).

28. خطط ترحيل/تراجع للبيانات (migrations للـLocal/Schema \+ خطة rollback مراقَبة).

# **ملحقات معيارية**

## **1\) جدول الكاش وTTL (SWR)**

| الشاشة/الخدمة | TTL | سياسة التحديث |
| ----- | ----- | ----- |
| Home/Banners | 10 دقائق | SWR فور فتح التطبيق |
| قائمة الأقسام | 24 ساعة | تحديث بالخلفية يوميًا |
| PLP (قائمة المنتجات) | 15 دقيقة | تحديث عند التمرير للأعلى |
| PDP (تفاصيل المنتج) | 60 دقيقة | تحديث عند الرجوع أو تغيير المقاس |
| البحث (اقتراحات) | 60 دقيقة | تحديث عند تغيّر المصطلح |
| السلة | لا كاش | حالة محلية فقط |
| الطلبات | 5 دقائق | تحديث عند الفتح |

## **2\) الروابط العميقة (Deep/Universal Links)**

* النطاقات المعتمدة: `app.zahraah.com` (Android App Links \+ iOS Universal Links).  
* خريطة مختصرة:  
  * `/p/:id` → PDP  
  * `/c/:slug` → PLP  
  * `/cart` → السلة  
  * `/o/:id` → تفاصيل الطلب  
* حالات الاختبار: مُثبّت/غير مُثبّت، مُسجّل/غير مُسجّل.

## **3\) الإشعارات (سياسات الإرسال)**

* قنوات: `promotions`, `orders`, `system`.  
* TTL الرسالة: 4 ساعات؛ `collapse_key` لكل قناة؛ **ساعات هادئة** 22:00–08:00.  
* Foreground: In-App Banner مع Deep-Link صحيح.

## **4\) خريطة أخطاء Backend→UI**

| كود | الرسالة العربية | إجراء المستخدم | شدة |
| ----- | ----- | ----- | ----- |
| `NET_TIMEOUT` | الاتصال بطيء…  | إعادة المحاولة | متوسطة |
| `OOS` | نفدت الكمية | اقتراح بدائل | منخفضة |
| `AUTH_EXPIRED` | انتهت الجلسة | تسجيل الدخول من جديد | عالية |
| `PAY_FAIL` | فش | اختيار وسيلة أخرى | عالية |

## **5\) ميزانيات الأداء (حدود إلزامية)**

* **App start P95 ≤ 2.5s**، **Screen load P95 ≤ 1.2s** (الشاشات الحرجة).  
* حجم التطبيق ≤ **45MB** (Android APK/IPA)، الصورة المفردة ≤ **180KB** (Hero)، **30KB** (Thumb).  
* Crash-free users ≥ **99.5%**.

## **6\) سياسة الصور والأصول**

* الصيغة: **WebP** (أساس)؛ fallback JPEG عند الحاجة.  
* أبعاد قصوى: Product Hero 1080×1350، Thumb 320×320.  
* عبر CDN مع ضغط تلقائي، Lazy-Loading وPlaceholders.

## **7\) أمان متقدّم**

* **SSL Pinning** (تجديد سنوي)، حظر لقطات الشاشة في OTP/الدفع.  
* كشف Root/Jailbreak مع مسار إيقاف آمن.

## **8\) السجلات Logging**

* المستويات: debug/info/warn/error.  
* إخفاء أي PII/رموز؛ **retention**: Dev 7 أيام، Prod أخطاء فقط.

## **9\) Runbooks حوادث (مختصر)**

* أعطال: تحقق Crashlytics → عزل الإصدار → Hotfix.  
* شبكة: تفقد Status/Backoff → بدائل/رسالة للمستخدم.  
* بطء: مراجعة Performance Traces → تحسين الصور/الاستعلامات.  
* دفع: فحص مزوّد/إعادة محاولة/تعطيل المسار مؤقّتًا.

## **10\) CI/CD لنظام iOS**

* macOS runner \+ توقيع أوتوماتيكي \+ TestFlight.  
* **Staged Rollout**: 10% → 50% → 100% خلال 48 ساعة.

## **11\) مصفوفة المنصات والأذونات**

* Android: minSdk 24 / target 34، iOS: min iOS 13+.  
* Privacy Manifest/Play Data Safety محدثان.

## **12\) التحليلات والهوية**

* حفظ **أول وآخر UTM** محليًا وربطهما بـ `user_id` في GA4.  
* مخطط أحداث موحّد للقمع الشرائي \+ خصائص الجهاز/الإصدار.

## **13\) Feature Flags / Remote Config**

* قائمة ميزات حرجة تحت أعلام (Checkout Guard, Free-Shipping Banner…).  
* **Rollback فوري** عبر العلم \+ إفراغ كاش الميزة.

## **14\) إدارة الأسرار**

* جميع المفاتيح عبر CI Secrets و`--dart-define`؛ **دوران كل 90 يومًا**.

## **15\) مرونة الشبكة**

* Timeouts: اتصال 5s، قراءة 10s، إجمالي 30s.  
* Retry 3 مرات \+ **Exponential Backoff**؛ **Circuit Breaker** بعد 5 فشل/60ث.

## **16\) بوابات جودة الإصدار (Release Gates)**

* نجاح Checkout ≥ **95%**، نسبة الأخطاء ≤ **1%** من الجلسات.  
* اختبارات تلقائية خضراء \+ Golden Tests للشاشات الأساسية.

## **17\) سياسة التبعيات**

* قفل نسخ (lockfile)، تدقيق أمني وترخيص رُبع سنوي، إزالة المهجور.

## **18\) سياسة البيانات المحلية**

* ما يُخزّن: جلسة/سلة/تفضيلات فقط. **تشفير** \+ تنظيف دوري (30 يومًا).

## **19\) الوصوليّة والـRTL**

* تباين ≥ 4.5:1، دعم تكبير الخط، اختبار TalkBack/VoiceOver.

## **20\) الموافقات والامتثال**

* مفاتيح Opt-in/Opt-out لـ Push/SMS/WhatsApp/Email داخل “الإعدادات”.  
* سياسة خصوصية داخل التطبيق مرتبطة بكل نقطة جمع بيانات.

## **21\) مؤشرات الواجهة (KPIs)**

* CTR البنرات ≥ **3%**، Add-to-Cart ≥ **8%**، Conversion ≥ **1.5%**.  
* تنبيهات عند الهبوط 20% عن الهدف لأسبوعين.

## **22\) التسمية Naming**

* المجلدات: `feature_name/…`، الملفات camelCase، الأصناف PascalCase،  
* اللاحقات: `…Repository`, `…UseCase`, `…Dto`, `…Notifier`.

## **23\) إعدادات البيئات (dev/stage/prod)**

* جدول واحد: `baseUrl`, `logLevel`, `featureFlags`, `analyticsId`.

## **24\) الإصدارات وChangelog**

* SemVer: MAJOR.MINOR.PATCH \+ **CHANGELOG.md** إلزامي مع كل إصدار.

## **25\) Offline/Sync**

* السلة **محلية دائمة** \+ دمج حسب (SKU+المقاس+اللون) عند المزامنة.  
* الطلبات: **Server-wins** دائمًا.

## **26\) سياسة الشبكات الضعيفة**

* Prefetch للصور الحرجة، Gzip/Brotli، خفض جودة الصور على 3G،  
* إرجاء طلبات الخلفية غير الحرجة.

## **27\) اختبار أمني دوري**

* MSTG-lite شهريًا \+ **Pen-Test نصف سنوي** مع تتبّع Findings.

## **28\) ترحيل/تراجع للبيانات**

* إصدارات للمخططات المحلية \+ **Migration scripts** \+ خطة Rollback.


---

## 🏠 **Back to Home | العودة للرئيسية**

[← Back to Main Index | العودة للفهرس الرئيسي](../../../index.html)

---
