# **تعليمات لضبط البنية والاختبارات (Flutter)**

1. المعمارية وهيكلة الملفات  
* اعتماد نمط واحد: feature-first مع طبقات presentation/domain/data ونمط Repository.  
* توثيق مختصر في ملف ARCHITECTURE.md يذكر: إدارة الحالة المختارة، آلية التنقل، طبقة البيانات، معالجة الأخطاء.  
* تنظيم المجلدات لكل ميزة: features/\<feature\>/{presentation,domain,data} وبنية core/{ui,network,errors,routing}.  
* منع استدعاءات الشبكة أو I/O داخل Widgets.  
* استخدام أسماء موحّدة: snake\_case للملفات، PascalCase للكلاسات.

2. إدارة الحالة والتنقل  
* اختيار إطار واحد لإدارة الحالة (Riverpod أو BLoC) وتطبيقه في جميع الميزات.  
* استخدام GoRouter بمسارات مركزيّة وحمايات للمسارات التي تتطلب تسجيل دخول.  
* تفعيل واختبار Deep Links/Dynamic Links لشاشات المنتج والعروض.

3. طبقة البيانات والشبكة  
* عميل شبكة مركزي (Dio أو Retrofit) مع مهلات زمنية وسياسة إعادة محاولة محدودة.  
* نماذج بيانات مولّدة (json\_serializable أو freezed)، بدون parsing يدوي.  
* كاش محلي منظم (Hive/Isar/Drift) مع سياسة صلاحية زمنية واضحة.  
* طبقة أخطاء موحّدة AppException بخرائط رسائل صديقة للمستخدم.

4. التصميم وملاءمة العربية  
* Design System موحّد (Theme/ColorScheme/Typography/Spacing) ومكوّنات UI مشتركة قابلة لإعادة الاستخدام.  
* دعم RTL واختبار تكبير الخط 1.3× و1.6× دون قص أو انعكاسات.  
* مكونات رئيسية مثل بطاقة المنتج وأزرار الشراء تُبنى كمكوّنات مشتركة.

5. الأمان والخصوصية  
* عدم تخزين الأسرار داخل الكود أو Git؛ تمريرها عبر dart-define/أسرار CI.  
* تخزين محلي مشفّر للرموز الحساسة باستخدام Keystore/Keychain.  
* احترام طلب المستخدم بإيقاف التتبع، وعدم إرسال بيانات شخصية حساسة للتحليلات.

6. التحليلات والقياس  
* إنشاء قاموس أحداث analytics\_events.md (أسماء ومتى تُطلق والمعلمات).  
* تتبّع كامل لمسار الشراء: view\_item → add\_to\_cart → begin\_checkout → add\_payment\_info (COD) → purchase.  
* إرسال أبعاد ثابتة لكل حدث: user\_id، app\_version، channel، currency، value.

7. الاختبارات والجودة  
* تفعيل linters وعدم قبول تحذيرات في flutter analyze.  
* تغطية اختبارات للمنطق الأساسي لا تقل عن 70%، مع Widget tests للشاشات الحرجة، وGolden tests للمكونات الأساسية.  
* اختبار تكاملي لتدفق “إضافة للسلة → تأكيد الطلب (الدفع عند الاستلام)”.

8. الأداء والموثوقية  
* أول إطار رسم أقل من ثانيتين على جهاز متوسط، وjank أقل من 1% في القوائم الطويلة.  
* فحص حجم البناء دورياً باستخدام \--analyze-size وعدم السماح بزيادة غير مبررة.  
* شاشات خطأ/انقطاع الشبكة مع زر إعادة المحاولة وتجربة استخدام واضحة.

9. CI/CD وقواعد الدمج  
* منع الدمج إلى main إلا عبر Pull Requests مع نجاح: format، analyze، tests، build.  
* بناء dev/stage/prod بنجاح على iOS/Android.  
* قالب PR يطلب لقطات قبل/بعد، تغطية للاختبارات، وأثر على التحليلات والحجم.

10. فحص القبول قبل أي دمج  
* نجاح flutter analyze بلا تحذيرات.  
* نجاح flutter test مع تغطية ≥ 70% للملفات المتأثرة.  
* نجاح Integration test لتدفق الشراء (COD).  
* سلوك Deep Link يعمل إلى صفحة منتج/عرض.  
* تقرير حجم البناء تمت مراجعته، ولا زيادة غير مبررة.

# **خطوات التحقق العملية (تشغّلونها أنتم وتوثّقون النتيجة)**

* تشغيل: dart format \--set-exit-if-changed .  
* تشغيل: flutter analyze (يجب صفر أخطاء/تحذيرات).  
* تشغيل: flutter test \--coverage (توثيق النسبة).  
* تشغيل في profile mode، قياس زمن أول إطار وjank عبر DevTools في الشاشات: الرئيسية، قائمة الفئة، السلة/الدفع.  
* بناء Android App Bundle وiOS (no codesign) لبيئات dev وstage وprod.  
* محاكاة شبكة ضعيفة وانقطاع تام للتأكد من رسائل الخطأ وزر إعادة المحاولة.  
* فتح Firebase/GA4 DebugView والتحقق من وصول أحداث: view\_item، add\_to\_cart، begin\_checkout، add\_payment\_info (COD)، purchase بالقيم الصحيحة.  
* اختبار RTL وتكبير الخط 1.3× و1.6× على الشاشات الحرجة مع مراجعة لقطات.  
* اختبار Deep Link إلى صفحة منتج وإلى صفحة عروض.  
* مراجعة أن لا توجد أسرار داخل المستودع وأن التخزين المحلي للرموز الحساسة مشفّر.

# **ملخص الاستفادة**

* توحيد البنية يقلل الديون التقنية ويجعل الإضافة والصيانة أسرع وأقل أخطاء.  
* منع تسرّب الشبكة إلى الواجهة يعزّز الاختبار وإعادة الاستخدام.  
* إدارة حالة موحّدة تقلل إعادة البناء وتحسّن الأداء.  
* تصميم موحّد وRTL صحيح يرفع جودة التجربة خصوصاً للعربية.  
* التحليلات المعيارية تمنح رؤية دقيقة لمسار الشراء وتسهّل قرارات التسويق.  
* اختبارات كافية \+ CI تقللان الأعطال وتمنعان regressions.  
* مراقبة الحجم والأداء تحافظ على سرعة التطبيق على الأجهزة المتوسطة والضعيفة.  
* أمان وخصوصية صحيحان يحميان البيانات ويكسبان ثقة المستخدم.


---

## 🏠 **Back to Home | العودة للرئيسية**

[← Back to Main Index | العودة للفهرس الرئيسي](../../../index.html)

---
